# FileEcho 用户手册

> 版本：v1.1.1-AI Embedded | 平台：Windows 10 / 11 (x64)

---

## 目录

1. [快速上手](#快速上手)
2. [文件扫描与管理](#文件扫描与管理)
3. [文件树操作](#文件树操作)
4. [AI 助手](#ai-助手)
5. [主题与语言](#主题与语言)
6. [快捷操作](#快捷操作)
7. [常见问题](#常见问题)

---

## 快速上手

1. 双击 `FileEcho.exe` 启动程序
2. 点击左上角地址栏旁的 **📂 浏览** 按钮选择文件夹
3. 点击 **扫描** 按钮（或按 Enter）开始扫描
4. 文件树将显示在主区域，右侧可打开 AI 助手面板

> **首次使用 AI 功能？** 点击右侧 ⚙️ 齿轮按钮，选择模型提供商、输入 API Key，保存即可。

---

## 文件扫描与管理

### 扫描文件夹

- **地址栏**：手动输入路径或点击 📂 按钮弹出系统文件夹选择对话框
- **扫描按钮**：点击后递归扫描整个目录
- **最大深度**：可设置扫描深度限制（默认不限制）

### 搜索与过滤

- **实时过滤**：在搜索框中输入关键字，文件树会实时筛选匹配项
- **路径裁剪**：按 Enter 后启用路径裁剪模式（只显示匹配文件及其父目录）
- **关键字高亮**：匹配的文件名会被黄色高亮标记

### 排序

支持三种排序方式，点击工具栏按钮切换：
- **按名称排序** — 字母顺序
- **按大小排序** — 从大到小
- **按深度排序** — 从浅到深

> 所有排序模式下，文件夹始终排在文件之前。

### 文件操作

- **双击文件行**：使用系统默认应用打开该文件
- **文件大小显示**：勾选 "Show Size" 可在文件名后显示大小

---

## 文件树操作

### 折叠/展开

- 点击目录行的 `[-]` 按钮可折叠该目录
- 再次点击 `[+]` 展开
- 折叠状态在搜索和导出时会被保留

### 导出文件树

工具栏提供两种导出方式：

- **📋 复制** — 将文件树文本复制到剪贴板
- **💾 下载** — 下载为 `.txt` 文件

导出内容使用标准 ASCII 连线格式：
```
MyProject/
├── src/
│   ├── main.cpp
│   └── utils.cpp
└── README.md
```

### AI 注释树（新功能）

点击 AI 面板中的 **🏷️ 注释树** 按钮，AI 会为文件树中的每个文件和目录生成简短注释，输出格式为左对齐的注释树：

```
MyProject/                    # 项目根目录
├── CMakeLists.txt            # CMake 构建配置
├── src/                      # 源代码目录
│   ├── main.cpp              # 程序入口
│   └── utils.cpp             # 工具函数
└── README.md                 # 项目说明文档
```

> 所有 `#` 注释自动左对齐到同一列，方便阅读和复制。

---

## AI 助手

### 初始配置

1. 点击右上角 **⚙️** 齿轮按钮打开设置面板
2. 选择 **模型提供商**（OpenAI / DeepSeek / Gemini / Grok / Claude / Kimi / GLM / Custom）
3. 输入 **API Key**
4. 选择 **模型**（下拉列表自动填充该提供商的可用模型）
5. （可选）填写 **Base URL**（用于 API 中转/代理服务）
6. 点击 **保存配置**
7. 点击 **测试连接** 验证配置是否正确

### 支持的模型

| 提供商 | 模型示例 |
|--------|----------|
| OpenAI | GPT-4.1, GPT-5, GPT-5.2 Pro |
| DeepSeek | DeepSeek Chat (V3), Reasoner (R1) |
| Google Gemini | Gemini 2.5 Flash/Pro, 3.0 Preview |
| xAI Grok | Grok 4 / 4.1 Fast (Reasoning) |
| Anthropic Claude | Haiku 4.5, Sonnet 4.5, Opus 4.6 |
| Kimi (月之暗面) | Kimi K2 Turbo, K2.5 |
| GLM (智谱 AI) | GLM-4.5 AirX ~ GLM-5 |
| Custom | 任何 OpenAI 兼容 API |

### Base URL 说明

- 默认情况下无需填写，程序自动使用官方 API 地址
- 使用第三方中转/代理时填写，例如 `https://api.example.com/v1`
- 如果填入的地址不包含 `/v1` 后缀，程序会弹出提示确认

### 温度控制

调节 AI 回复的创造性程度：

- **精确 (0.3)** — 严格、确定性强的回答
- **平衡 (0.7)** — 默认，兼顾准确与灵活
- **创意 (1.0)** — 更具创造性的回答
- **滑块微调** — 0.0 ~ 2.0 之间任意值

### 快捷功能按钮

AI 面板底部的功能芯片（Chips）：

| 按钮 | 功能 | 说明 |
|------|------|------|
| 📊 项目概述 | 分析项目类型、技术栈、模块结构 | 基于文件树推断 |
| 💡 调整建议 | 提出文件整理和结构优化建议 | 识别临时文件、冗余配置 |
| 💻 代码分析 | 分析代码结构、命名规范、主要语言 | 基于文件树推断 |
| 📄 文件摘要 | 选择一个文件，AI 生成详细摘要 | 支持代码/文本/PDF/Office |
| 🧠 智能搜索 | 用自然语言描述要查找的内容 | AI 匹配相关文件 |
| 🏷️ 注释树 | 为文件树中每个文件生成注释 | 输出左对齐的注释文件树 |

### 聊天功能

- **自由对话**：在输入框中输入任意问题
- **文件引用**：消息中提到文件名时，AI 自动读取文件内容作为上下文
- **文件选择**：勾选文件树中的文件复选框，再发消息，AI 只分析选中文件
- **Markdown 渲染**：AI 回复支持标题、代码块、表格、列表、引用块
- **LaTeX 数学公式**：支持行内 `$...$` 和块级 `$$...$$` 公式渲染
- **Token 统计**：每次 AI 回复后，底栏显示 Prompt / Completion / Total token 数
- **新对话清零**：点击 ➕ 新对话按钮会清空聊天记录并重置 Token 计数

### 悬停摘要

将鼠标悬停在文件树中的文件或文件夹上，会弹出一个 AI 生成的摘要卡片，包含文件类型识别和内容预览。

### 复制聊天记录

点击 AI 面板标题栏的 **📋 复制** 按钮，聊天记录会以 Markdown 格式复制到剪贴板，成功后弹出提示。

### 重置设置

⚙️ 设置面板中的 **重置** 按钮会将 AI 配置恢复为默认值，但**不会清除聊天记录**。

---

## 主题与语言

### 切换主题

点击左侧侧边栏的 **🎨 主题** 按钮，可选择 6 种主题：

| 主题 | 风格 |
|------|------|
| Light | 明亮白色 |
| Obsidian | 深灰暗色 |
| Sublime Monokai | 暖色调暗色 |
| Windows Dark | 微软深色风格 |
| Dracula | 紫色调经典暗色 |
| Deep Space | 深蓝太空风格 |

> AI 面板会自动适应当前所选主题的配色。

### 切换语言

点击侧边栏的 **🌐 语言** 按钮在中文/英文之间切换。所有 UI 文字和 AI 交互语言都会同步切换。

---

## 快捷操作

### 面板调整

- **拖拽 AI 面板边缘**：按住 AI 面板的左边缘向左/右拖动可调整面板宽度

### 文件选择

- **复选框**：文件树中每行都有复选框，勾选后 AI 分析仅针对选中的文件
- **上下文显示**：AI 面板顶部显示当前路径和已选文件数量

---

## 常见问题

### Q: 启动后白屏或无法显示界面？
**A:** 需要安装 [WebView2 Runtime](https://developer.microsoft.com/en-us/microsoft-edge/webview2/)。Windows 11 自带，Windows 10 需手动安装。

### Q: AI 连接失败？
**A:** 检查以下几点：
1. API Key 是否正确
2. 网络是否能访问对应的 API 服务
3. 使用代理时 Base URL 是否正确，是否包含 `/v1` 后缀
4. 系统代理设置是否正确（程序自动使用系统代理）

### Q: 程序被杀毒软件误删？
**A:** 这是 MinGW 编译产物的常见误报。v1.1.1 已启用静态链接、strip 和 VERSIONINFO 资源降低误报率。如仍被拦截，请在杀毒软件中添加例外。

### Q: 扫描大目录很慢？
**A:** 程序使用多线程并行扫描，一般来说十万级文件也能在数秒内完成。如确认缓慢，可设置 **最大深度** 限制递归层级。

### Q: 支持哪些文件格式的内容读取？
**A:** AI 可读取：
- 纯文本文件（代码、配置、日志等）
- PDF 文件（自动提取文字）
- Office 文件（DOCX、XLSX、PPTX）
- 二进制文件会被跳过
